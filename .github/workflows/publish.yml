name: Publish the new version of the course to the API
on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  # the AMS key generated by an admin
  API_KEY: "${{ secrets.API_KEY }}"
  # e.g. https://api.kibo.school or https://develop.api.kibo.school
  API_URL: "${{ secrets.DEPLOY_URL }}"
jobs:
  deploy:
    name: publish
    runs-on: ubuntu-latest
    permissions:
      contents: "read"
      id-token: "write"
    steps:
      - name: publish
        run: |
          curl --request PUT --url $API_URL/api/latest/courses -H "Authorization: SharedKey $API_KEY" -H "Content-Type: application/json" --data '{"github_path": "'$GITHUB_ACTION_REPOSITORY'"}'
